package org.kae.ustax4s.states

import org.kae.ustax4s.Brackets.Brackets
import org.kae.ustax4s.federal.{FederalCalcInput, FederalCalcResults}
import org.kae.ustax4s.money.Moneys.{Deduction, TaxPayable}
import scala.annotation.unused

// Model this: https://docs.google.com/spreadsheets/d/1I_OuA6uuAs7YoZRc02atHCCxpXaGDn9N/edit?gid=201796956#gid=201796956

sealed trait HasStateTaxDue:
  def stateTaxDue: TaxPayable
end HasStateTaxDue

sealed trait StateTaxRegime

object StateTaxRegime:
  import State.*
  def of(state: State): StateTaxRegime =
    state match
      case AK | FL | NV | NH | SD | TN | TX | WA | WY => NilStateTaxRegime

      case CO =>
        // From fed taxable income.
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(4.4 / 100),
          ???,
          ???,
          ???,
          ???
        )
      case IL =>
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(4.95 / 100),
          ???,
          ???,
          ???,
          ???
        )
      case IN =>
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(3.05 / 100),
          ???,
          ???,
          ???,
          ???
        )
      case MI =>
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(4.25 / 100),
          ???,
          ???,
          ???,
          ???
        )
      case NC =>
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(4.25 / 100),
          ???,
          ???,
          ???,
          ???
        )
      case PA =>
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(3.07 / 100),
          ???,
          ???,
          ???,
          ???
        )
      case UT =>
        FlatStateTaxRegime(
          StateTaxRate.unsafeFrom(4.85 / 100),
          ???,
          ???,
          ???,
          ???
        )

      // Progressive: TODO
      case AL => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case AZ => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case AR => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case AS => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case CA => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case CT => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case DE => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case DC => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case GA => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case GU => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case HI => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case ID => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case IA => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case KS => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case KY => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case LA => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case ME => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MD => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MA => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MN => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MS => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MO => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MT => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case NE => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case NJ => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case NM => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case NY => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case ND => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case MP => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case OH => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case OK => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case OR => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case PR => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case RI => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case SC => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case TT => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case VT => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case VA => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case VI => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case WV => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
      case WI => ProgressiveStateTaxRegime(???, ???, ???, ???, ???)
    end match
  end of
end StateTaxRegime

sealed trait HasStateTaxCalculator:
  def standardDeductions: MaritalStatus => Deduction
  def standardExemptions: MaritalStatus => Deduction
  def perDependentExemption: Deduction
  def exemptionsAreCredits: Boolean

  def calculator(
    federalInput: FederalCalcInput,
    federalCalcResults: FederalCalcResults
  ): HasStateTaxDue

case object NilStateTaxRegime extends StateTaxRegime, HasStateTaxDue:
  override val stateTaxDue: TaxPayable = TaxPayable.zero
end NilStateTaxRegime

class FlatStateTaxRegime(
  @unused
  rate: StateTaxRate,
  override val standardDeductions: MaritalStatus => Deduction,
  override val standardExemptions: MaritalStatus => Deduction,
  override val perDependentExemption: Deduction,
  override val exemptionsAreCredits: Boolean
) extends StateTaxRegime,
      HasStateTaxCalculator:
  override def calculator(
    federalInput: FederalCalcInput,
    federalCalcResults: FederalCalcResults
  ): HasStateTaxDue = ???
end FlatStateTaxRegime

class ProgressiveStateTaxRegime(
  @unused
  brackets: Brackets[StateTaxRate],
  override val standardDeductions: MaritalStatus => Deduction,
  override val standardExemptions: MaritalStatus => Deduction,
  override val perDependentExemption: Deduction,
  override val exemptionsAreCredits: Boolean
) extends StateTaxRegime,
      HasStateTaxCalculator:
  override def calculator(
    federalInput: FederalCalcInput,
    federalCalcResults: FederalCalcResults
  ): HasStateTaxDue = ???
end ProgressiveStateTaxRegime
